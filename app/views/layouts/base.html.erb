<!DOCTYPE html>

<!--[if IE 7 ]> <html lang="<%= I18n.locale %>" class="ie ie7 no-js"> <![endif]-->
<!--[if IE 8 ]> <html lang="<%= I18n.locale %>" class="ie ie8 no-js"> <![endif]-->
<!--[if IE 9 ]> <html lang="<%= I18n.locale %>" class="ie ie9 no-js"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--><html lang="<%= I18n.locale %>" class="no-js"><!--<![endif]-->

<head>
  <%= display_meta_tags(site: t('.title'), reverse: true, separator: '-') %>
  <%= csrf_meta_tags %>

  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=Edge" /><![endif]-->
  <!--[if IEMobile]><meta http-equiv="cleartype" content="on"><![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="HandheldFriendly" content="True">

  <%= baseline_grid %>

  <%# Basic styles for all devices, doesnt contain anything that could cause rendering issues such as positional info %>
  <%= stylesheet_link_tag 'basic' %>

  <%# Fixed width styles and html5shiv for IE7+8 , styles will not include any media queries, but will include .ie specific fixes %>
  <!--[if ( gte IE 7 ) & ( lte IE 8 ) & (!IEMobile) ]>
    <%= stylesheet_link_tag 'enhanced_fixed', media: 'all' %>
    <%= javascript_include_tag 'html5shiv/dist/html5shiv.js' %>
  <![endif]-->

  <%# Responsive styles for all modern devices, excluded from older IE version %>
  <!--[if ( !IE ) | ( gte IE 9 ) ]><!-->
  <%= stylesheet_link_tag 'enhanced_responsive', media: 'only all' %>
  <!--<![endif]-->

  <%= yield :head %>

  <%# Any JS that is required before DOM is created should be in this block
      includes feature detection, analytics setup, json bootstrap %>
  <script type="text/javascript">

    // Required for Google Tag Manager
    dataLayer = [{
      'Responsive page': 'Yes',
      'event': 'Responsive page'
    }];

    // Any properties that require Ruby @ runtime
    var MAS = window.MAS || {};
    MAS.bootstrap = {
      env: '<%= Rails.env %>',
      timestamp: new Date().getTime(),
      fontsUrl: '<%= stylesheet_path('fonts') %>',
      I18n_locale: '<%= I18n.locale %>'
    }

    MAS.supports = (function(w,d){
      var S = {};

      function supportTest(prop, context){
        try {
          return prop in context && context[prop] !== null;
        } catch (e) {
          return false;
        }
      }

      S.fonts = false; // Required for webfont loader to work, default false, set true in view/base
      S.js = ( supportTest('querySelector',d) && supportTest('localStorage',w) && supportTest('addEventListener',w) ) ? 'advanced' : 'basic';
      S.touch = ( supportTest('ontouchstart', w) || supportTest('onmsgesturechange',w) );
      S.localstorage = supportTest('localStorage', w);
      S.svg = (function(){ return !!d.createElementNS && !!d.createElementNS('http://www.w3.org/2000/svg', "svg").createSVGRect })();

      return S
    })(window, document);

    (function(w,d){
      // Update className
      var el = d.getElementsByTagName('html')[0];
      el.className = el.className.replace('no-js', 'js js-' + MAS.supports.js);

      <%#
      Fix for iPhone viewport scale bug  => http://www.blog.highub.com/mobile-2/a-fix-for-iphone-viewport-scale-bug
      vp = viewport / ua = useragent / gs = gesture start / sf = scaleFix
      %>
      var vp, ua, gs, sf;
      vp = d.querySelector && d.querySelector('meta[name="viewport"]');
      ua = navigator.userAgent;
      sf = function () {
        if (vp && /iPhone|iPad|iPod/.test(ua) && !/Opera Mini/.test(ua)) {
          vp.content = "width=device-width, minimum-scale=1.0, maximum-scale=1.0";
          d.addEventListener("gesturestart", gs, false);
        }
      };
      gs = function () {
        vp.content = "width=device-width, minimum-scale=0.25, maximum-scale=1.6";
      };
    })(window,document);

  </script>

  <!--[ if ( !IE ) | ( gte IE 9 ) ]><!-->
    <script>
      // Limits loading to only supported browsers, ie7/8 loads fixed.css which has fonts inline as desktop browsers should have better bandwidth
      MAS.supports.fonts = true;
    </script>
  <!--<![endif]-->

</head>
<body class="<%= locale_class %>">
  <noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=<%= Rails.application.config.google_tag_manager_id %>"
            height="0" width="0" style="display:none;visibility:hidden"
            title="Google Tag Manager"></iframe>
  </noscript>
  <script>
    (function (w, d, s, l, i) {
      w[l] = w[l] || [];
      w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
      var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
          j.async = true;
          j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
          f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', '<%= Rails.application.config.google_tag_manager_id %>');
  </script>

  <a  id="top"></a>

  <%= content_for?(:content) ? yield(:content) : yield %>

  <% if Rails.env.development? %>
    <!--[if (gt IE 9)|!(IE)]><!-->
    <%= javascript_include_tag 'html_inspector' %>
    <!--<![endif]-->
  <% end %>

  <%= javascript_include_tag 'requirejs/require', data: { main: javascript_path('application') } %>
  <%= yield :scripts %>

</body>
</html>
